---
title: 'Auto-Expiry (TTL)'
description: 'Automatically clean up temporary resources'
---

Managing the lifecycle of temporary resources (like shareable links, export files, or beta accounts) is often overlooked. Instead of running a nightly "cleanup cron," you can schedule the deletion at the exact moment of creation.

## Workflow

1.  **Schedule**: When you create a resource, schedule its deletion for `X` hours later.
2.  **Handle**: Delete the resource.

```javascript
/* 1. Schedule */
async function createShareableLink(fileId) {
  // 1. Create the temporary link
  const linkToken = await db.createLink({ fileId });

  // 2. Schedule expiration for 24 hours
  posthook.schedule({
    path: '/webhooks/expire-link',
    postAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
    data: {
      token: linkToken
    }
  });

  return linkToken;
}

/* 2. Handle */
app.post('/webhooks/expire-link', async (req, res) => {
  // Verify the signature (see 'Hook Fulfillment' for implementation)
  if (!verifyPosthookSignature(req)) return res.status(401).send('Invalid signature');

  const { token } = req.body.data;

  // Check if it was already manually deleted?
  const link = await db.getLink(token);
  if (!link) {
    return res.status(200).send('Already deleted');
  }

  // Perform the cleanup
  await db.deleteLink(token);
  
  res.status(200).send('Resource expired');
});
```
